{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 130, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/prajw/Documents/projects/Cooked-SpotifyRoast/app/api/roast/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\nimport { cookies } from 'next/headers';\r\nimport axios from 'axios';\r\nimport { GoogleGenerativeAI } from '@google/generative-ai';\r\n\r\nexport async function GET(request: NextRequest) {\r\n    const cookieStore = await cookies();\r\n    const sessionCookie = cookieStore.get('spotify_session');\r\n\r\n    console.log('Roast API - Received Cookies:', cookieStore.getAll());\r\n    console.log('Roast API - Session Cookie:', sessionCookie);\r\n\r\n    if (!sessionCookie || !sessionCookie.value) {\r\n        return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    let session;\r\n    try {\r\n        session = JSON.parse(sessionCookie.value);\r\n    } catch (e) {\r\n        console.error('Failed to parse session cookie:', e);\r\n        return NextResponse.json({ error: 'Invalid session' }, { status: 401 });\r\n    }\r\n\r\n    if (!session || !session.access_token) {\r\n        return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\r\n    }\r\n\r\n    const { access_token } = session;\r\n\r\n    try {\r\n        // Fetch Spotify Data in parallel\r\n        const [userProfile, topArtists, topTracks, recentlyPlayed] = await Promise.all([\r\n            axios.get('https://api.spotify.com/v1/me', { headers: { Authorization: `Bearer ${access_token}` } }),\r\n            axios.get('https://api.spotify.com/v1/me/top/artists?limit=10&time_range=medium_term', { headers: { Authorization: `Bearer ${access_token}` } }),\r\n            axios.get('https://api.spotify.com/v1/me/top/tracks?limit=10&time_range=medium_term', { headers: { Authorization: `Bearer ${access_token}` } }),\r\n            axios.get('https://api.spotify.com/v1/me/player/recently-played?limit=10', { headers: { Authorization: `Bearer ${access_token}` } }),\r\n        ]);\r\n\r\n        const dataSummary = {\r\n            user: userProfile.data.display_name,\r\n            topArtists: topArtists.data.items.map((artist: any) => artist.name).join(', '),\r\n            topTracks: topTracks.data.items.map((track: any) => `${track.name} by ${track.artists[0].name}`).join(', '),\r\n            recent: recentlyPlayed.data.items.map((item: any) => `${item.track.name} by ${item.track.artists[0].name}`).join(', '),\r\n        };\r\n\r\n        // Call Gemini\r\n        const geminiApiKey = process.env.GEMINI_API_KEY;\r\n        if (!geminiApiKey) {\r\n            return NextResponse.json({ error: 'Gemini API key missing' }, { status: 500 });\r\n        }\r\n\r\n        const genAI = new GoogleGenerativeAI(geminiApiKey);\r\n        const model = genAI.getGenerativeModel({ model: 'gemini-pro' });\r\n\r\n        const prompt = `\r\n      You are a ruthless, witty, and hilarious music critic. Your job is to roast the user's music taste based on their Spotify history.\r\n      \r\n      Here is the user's data:\r\n      Name: ${dataSummary.user}\r\n      Top Artists: ${dataSummary.topArtists}\r\n      Top Tracks: ${dataSummary.topTracks}\r\n      Recently Played: ${dataSummary.recent}\r\n\r\n      Instructions:\r\n      1. Be mean but funny. Use Gen Z slang if appropriate but don't overdo it.\r\n      2. Call out specific embarrassing artists or songs.\r\n      3. Make assumptions about their personality based on their music.\r\n      4. Keep it under 200 words.\r\n      5. Address them directly.\r\n    `;\r\n\r\n        const result = await model.generateContent(prompt);\r\n        const response = await result.response;\r\n        const text = response.text();\r\n\r\n        return NextResponse.json({ roast: text });\r\n\r\n    } catch (error: any) {\r\n        console.error('Error generating roast:', error.response?.data || error.message);\r\n        return NextResponse.json({ error: 'Failed to generate roast' }, { status: 500 });\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}}]
}