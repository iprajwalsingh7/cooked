{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 136, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/prajw/Documents/projects/Cooked-SpotifyRoast/lib/sessionStore.ts"],"sourcesContent":["import fs from 'fs';\r\nimport path from 'path';\r\n\r\nconst sessionsFilePath = path.join(process.cwd(), 'sessions.json');\r\n\r\n// Ensure file exists\r\nif (!fs.existsSync(sessionsFilePath)) {\r\n    fs.writeFileSync(sessionsFilePath, JSON.stringify({}));\r\n}\r\n\r\nexport function saveSession(sessionId: string, data: any) {\r\n    const sessions = JSON.parse(fs.readFileSync(sessionsFilePath, 'utf-8'));\r\n    sessions[sessionId] = data;\r\n    fs.writeFileSync(sessionsFilePath, JSON.stringify(sessions, null, 2));\r\n}\r\n\r\nexport function getSession(sessionId: string) {\r\n    const sessions = JSON.parse(fs.readFileSync(sessionsFilePath, 'utf-8'));\r\n    return sessions[sessionId] || null;\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAEA,MAAM,mBAAmB,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI;AAElD,qBAAqB;AACrB,IAAI,CAAC,wGAAE,CAAC,UAAU,CAAC,mBAAmB;IAClC,wGAAE,CAAC,aAAa,CAAC,kBAAkB,KAAK,SAAS,CAAC,CAAC;AACvD;AAEO,SAAS,YAAY,SAAiB,EAAE,IAAS;IACpD,MAAM,WAAW,KAAK,KAAK,CAAC,wGAAE,CAAC,YAAY,CAAC,kBAAkB;IAC9D,QAAQ,CAAC,UAAU,GAAG;IACtB,wGAAE,CAAC,aAAa,CAAC,kBAAkB,KAAK,SAAS,CAAC,UAAU,MAAM;AACtE;AAEO,SAAS,WAAW,SAAiB;IACxC,MAAM,WAAW,KAAK,KAAK,CAAC,wGAAE,CAAC,YAAY,CAAC,kBAAkB;IAC9D,OAAO,QAAQ,CAAC,UAAU,IAAI;AAClC"}},
    {"offset": {"line": 170, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/prajw/Documents/projects/Cooked-SpotifyRoast/app/api/auth/callback/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\nimport axios from 'axios';\r\nimport querystring from 'querystring';\r\nimport { saveSession } from '@/lib/sessionStore';\r\nimport { v4 as uuidv4 } from 'uuid';\r\n\r\nexport async function GET(request: NextRequest) {\r\n    const searchParams = request.nextUrl.searchParams;\r\n    const code = searchParams.get('code');\r\n    const state = searchParams.get('state');\r\n\r\n    if (state === null) {\r\n        return NextResponse.redirect(new URL('/?error=state_mismatch', request.url));\r\n    }\r\n\r\n    const client_id = process.env.SPOTIFY_CLIENT_ID;\r\n    const client_secret = process.env.SPOTIFY_CLIENT_SECRET;\r\n    const redirect_uri = process.env.SPOTIFY_REDIRECT_URI;\r\n\r\n    if (!client_id || !client_secret || !redirect_uri) {\r\n        return NextResponse.json({ error: 'Missing Spotify credentials' }, { status: 500 });\r\n    }\r\n\r\n    try {\r\n        const response = await axios.post(\r\n            'https://accounts.spotify.com/api/token',\r\n            querystring.stringify({\r\n                code: code,\r\n                redirect_uri: redirect_uri,\r\n                grant_type: 'authorization_code',\r\n            }),\r\n            {\r\n                headers: {\r\n                    'Content-Type': 'application/x-www-form-urlencoded',\r\n                    Authorization: 'Basic ' + Buffer.from(client_id + ':' + client_secret).toString('base64'),\r\n                },\r\n            }\r\n        );\r\n\r\n        const { access_token, refresh_token } = response.data;\r\n\r\n        // Generate Session ID\r\n        const sessionId = uuidv4();\r\n\r\n        // Save to file store\r\n        saveSession(sessionId, { access_token, refresh_token });\r\n\r\n        console.log('Session ID generated:', sessionId);\r\n\r\n        // Redirect with session_id in query param (bypass cookies)\r\n        return NextResponse.redirect(new URL(`/roast?session_id=${sessionId}`, request.url));\r\n    } catch (error: any) {\r\n        console.error('Error exchanging token:', error.response?.data || error.message);\r\n        console.error('Full Error:', error);\r\n        return NextResponse.redirect(new URL('/?error=invalid_token', request.url));\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;;;;;;AAEO,eAAe,IAAI,OAAoB;IAC1C,MAAM,eAAe,QAAQ,OAAO,CAAC,YAAY;IACjD,MAAM,OAAO,aAAa,GAAG,CAAC;IAC9B,MAAM,QAAQ,aAAa,GAAG,CAAC;IAE/B,IAAI,UAAU,MAAM;QAChB,OAAO,gJAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,0BAA0B,QAAQ,GAAG;IAC9E;IAEA,MAAM,YAAY,QAAQ,GAAG,CAAC,iBAAiB;IAC/C,MAAM,gBAAgB,QAAQ,GAAG,CAAC,qBAAqB;IACvD,MAAM,eAAe,QAAQ,GAAG,CAAC,oBAAoB;IAErD,IAAI,CAAC,aAAa,CAAC,iBAAiB,CAAC,cAAc;QAC/C,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA8B,GAAG;YAAE,QAAQ;QAAI;IACrF;IAEA,IAAI;QACA,MAAM,WAAW,MAAM,kJAAK,CAAC,IAAI,CAC7B,0CACA,0HAAW,CAAC,SAAS,CAAC;YAClB,MAAM;YACN,cAAc;YACd,YAAY;QAChB,IACA;YACI,SAAS;gBACL,gBAAgB;gBAChB,eAAe,WAAW,OAAO,IAAI,CAAC,YAAY,MAAM,eAAe,QAAQ,CAAC;YACpF;QACJ;QAGJ,MAAM,EAAE,YAAY,EAAE,aAAa,EAAE,GAAG,SAAS,IAAI;QAErD,sBAAsB;QACtB,MAAM,YAAY,IAAA,mLAAM;QAExB,qBAAqB;QACrB,IAAA,oIAAW,EAAC,WAAW;YAAE;YAAc;QAAc;QAErD,QAAQ,GAAG,CAAC,yBAAyB;QAErC,2DAA2D;QAC3D,OAAO,gJAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,CAAC,kBAAkB,EAAE,WAAW,EAAE,QAAQ,GAAG;IACtF,EAAE,OAAO,OAAY;QACjB,QAAQ,KAAK,CAAC,2BAA2B,MAAM,QAAQ,EAAE,QAAQ,MAAM,OAAO;QAC9E,QAAQ,KAAK,CAAC,eAAe;QAC7B,OAAO,gJAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,yBAAyB,QAAQ,GAAG;IAC7E;AACJ"}}]
}