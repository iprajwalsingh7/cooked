{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 136, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/prajw/Documents/projects/Cooked-SpotifyRoast/app/api/auth/callback/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\nimport axios from 'axios';\r\nimport { serialize } from 'cookie';\r\nimport querystring from 'querystring';\r\n\r\nexport async function GET(request: NextRequest) {\r\n    const searchParams = request.nextUrl.searchParams;\r\n    const code = searchParams.get('code');\r\n    const state = searchParams.get('state');\r\n\r\n    if (state === null) {\r\n        return NextResponse.redirect(new URL('/?error=state_mismatch', request.url));\r\n    }\r\n\r\n    const client_id = process.env.SPOTIFY_CLIENT_ID;\r\n    const client_secret = process.env.SPOTIFY_CLIENT_SECRET;\r\n    const redirect_uri = process.env.SPOTIFY_REDIRECT_URI;\r\n\r\n    if (!client_id || !client_secret || !redirect_uri) {\r\n        return NextResponse.json({ error: 'Missing Spotify credentials' }, { status: 500 });\r\n    }\r\n\r\n    try {\r\n        const response = await axios.post(\r\n            'https://accounts.spotify.com/api/token',\r\n            querystring.stringify({\r\n                code: code,\r\n                redirect_uri: redirect_uri,\r\n                grant_type: 'authorization_code',\r\n            }),\r\n            {\r\n                headers: {\r\n                    'Content-Type': 'application/x-www-form-urlencoded',\r\n                    Authorization: 'Basic ' + Buffer.from(client_id + ':' + client_secret).toString('base64'),\r\n                },\r\n            }\r\n        );\r\n\r\n        const { access_token, refresh_token } = response.data;\r\n\r\n        // Serialize the cookie\r\n        const cookie = serialize('spotify_session', JSON.stringify({ access_token, refresh_token }), {\r\n            httpOnly: true,\r\n            secure: false, // Force false for development\r\n            maxAge: 60 * 60 * 24 * 7, // 1 week\r\n            path: '/',\r\n            sameSite: 'lax',\r\n        });\r\n\r\n        console.log('Cookie Length:', cookie.length);\r\n\r\n        const testCookie = serialize('test_cookie', 'hello_world', {\r\n            httpOnly: true,\r\n            secure: false,\r\n            path: '/',\r\n            sameSite: 'lax',\r\n        });\r\n\r\n        const res = NextResponse.redirect(new URL('/roast', request.url));\r\n        res.headers.append('Set-Cookie', cookie);\r\n        res.headers.append('Set-Cookie', testCookie);\r\n\r\n        return res;\r\n    } catch (error: any) {\r\n        console.error('Error exchanging token:', error.response?.data || error.message);\r\n        console.error('Full Error:', error);\r\n        return NextResponse.redirect(new URL('/?error=invalid_token', request.url));\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;AAEO,eAAe,IAAI,OAAoB;IAC1C,MAAM,eAAe,QAAQ,OAAO,CAAC,YAAY;IACjD,MAAM,OAAO,aAAa,GAAG,CAAC;IAC9B,MAAM,QAAQ,aAAa,GAAG,CAAC;IAE/B,IAAI,UAAU,MAAM;QAChB,OAAO,gJAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,0BAA0B,QAAQ,GAAG;IAC9E;IAEA,MAAM,YAAY,QAAQ,GAAG,CAAC,iBAAiB;IAC/C,MAAM,gBAAgB,QAAQ,GAAG,CAAC,qBAAqB;IACvD,MAAM,eAAe,QAAQ,GAAG,CAAC,oBAAoB;IAErD,IAAI,CAAC,aAAa,CAAC,iBAAiB,CAAC,cAAc;QAC/C,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA8B,GAAG;YAAE,QAAQ;QAAI;IACrF;IAEA,IAAI;QACA,MAAM,WAAW,MAAM,kJAAK,CAAC,IAAI,CAC7B,0CACA,0HAAW,CAAC,SAAS,CAAC;YAClB,MAAM;YACN,cAAc;YACd,YAAY;QAChB,IACA;YACI,SAAS;gBACL,gBAAgB;gBAChB,eAAe,WAAW,OAAO,IAAI,CAAC,YAAY,MAAM,eAAe,QAAQ,CAAC;YACpF;QACJ;QAGJ,MAAM,EAAE,YAAY,EAAE,aAAa,EAAE,GAAG,SAAS,IAAI;QAErD,uBAAuB;QACvB,MAAM,SAAS,IAAA,sJAAS,EAAC,mBAAmB,KAAK,SAAS,CAAC;YAAE;YAAc;QAAc,IAAI;YACzF,UAAU;YACV,QAAQ;YACR,QAAQ,KAAK,KAAK,KAAK;YACvB,MAAM;YACN,UAAU;QACd;QAEA,QAAQ,GAAG,CAAC,kBAAkB,OAAO,MAAM;QAE3C,MAAM,aAAa,IAAA,sJAAS,EAAC,eAAe,eAAe;YACvD,UAAU;YACV,QAAQ;YACR,MAAM;YACN,UAAU;QACd;QAEA,MAAM,MAAM,gJAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,QAAQ,GAAG;QAC/D,IAAI,OAAO,CAAC,MAAM,CAAC,cAAc;QACjC,IAAI,OAAO,CAAC,MAAM,CAAC,cAAc;QAEjC,OAAO;IACX,EAAE,OAAO,OAAY;QACjB,QAAQ,KAAK,CAAC,2BAA2B,MAAM,QAAQ,EAAE,QAAQ,MAAM,OAAO;QAC9E,QAAQ,KAAK,CAAC,eAAe;QAC7B,OAAO,gJAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,yBAAyB,QAAQ,GAAG;IAC7E;AACJ"}}]
}